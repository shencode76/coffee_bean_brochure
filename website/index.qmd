---
# title: "Coffee Bean Brochure"
format:
  html:
    toc: false   
editor: visual

resources:
  - img
  - visualization/data/bubble_with_descriptions.json
  - visualization/data/sentiment_blocks.json
  - visualization/details/**
  - visualization/bubble_bounce_hover.js
  - visualization/sentiment_block_plot.js
  - visualization/block_timeline_sentiment.js 
javascripts:
  - visualization/bubble_bounce_hover.js
  - visualization/sentiment_block_plot.js
---

```{=html}
<!-- <!DOCTYPE html> -->
<html lang="zh">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Coffee Bean Brochure</title>
  <script src="https://unpkg.com/scrollama"></script>
    
  <link rel="stylesheet" href="styles.css">
  <style>
    /* Introduce Google fonts */
    @import url('https://fonts.googleapis.com/css2?family=Lora:wght@400;700&family=Pacifico&display=swap');

    /* Global styles */
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
      left: 0;
    }

    /* Ensure html and body fill the full screen */
    html, body {
      margin: 0;
      padding: 0;
      left: 0;
      right: 0;
      width: 100%;
/*       height: 100%; */
      overflow-x: hidden;
      box-sizing: border-box;
      scroll-behavior: smooth;
    }

    /* Container */
    .container {
      position: relative;
      width: 100%;
      height: 100vh;
      overflow: hidden;
    }

    /* Coffee bean image */
    .coffee-bean {
      position: absolute;
      left: -150px;
      animation: rollIn 5s ease-out forwards;
      z-index: 1;
    }

    /* Coffee bean rolling animation */
    @keyframes rollIn {
      0% { left: -150px; }
      50% { left: 50%; transform: translateX(-50%); }
      100% { left: 50%; transform: translateX(-50%); }
    }

    /* Title styles */
    .vibrant-title {
      width: 100%;
      position: relative;
      display: inline-block;
      padding: 1rem 2rem;
      font-family: 'Pacifico', cursive;
      font-size: 4rem;
      color: #6F4F37;
      text-align: center;
      text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.2);
      opacity: 0;
      animation: fadeIn 2s ease-out forwards;
      z-index: 2;
    }

    .vibrant-title-down {
      width: 100%;
      background: #FEF8F2;
      position: relative;
      display: inline-block;
      padding: 1rem 2rem;
      /* font-family: 'Pacifico', cursive; */
      font-size: 1rem;
      color: #6F4F37;
      text-align: center;
      text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.2);
      opacity: 0;
      animation: fadeIn 2s ease-out forwards;
      z-index: 2;
    }

    .vibrant-title::before {
      content: "";
      position: absolute;
      top: 0;
      left: -50vw;
      right: -50vw;
      bottom: 0;
      background-color: #FEF8F2;
      z-index: -1;
    }
     .vibrant-title-down::before {
      content: "";
      position: absolute;
      top: 0;
      left: -50vw;
      right: -50vw;
      bottom: 0;
      background-color: #FEF8F2;
      z-index: -1;
    }

    /* Fade-in animation */
    @keyframes fadeIn {
      0% { opacity: 0; }
      60% { opacity: 0.7; }
      100% { opacity: 1; }
    }

    .carousel-container, .category, .carousel-wrapper {
      width: 100vw;
      position: relative;
      left: 50%;
      margin-left: -50vw;
      padding: 0;
    }

    .carousel {
      display: flex;
      width: 100vw;
      height: 50vh;
      position: relative;
    }

    .carousel-slide {
      position: absolute;
      top: 0;
      left: 0;
      width: 100vw;
      height: 100%;
      background-size: cover;
      background-position: center;
      background-repeat: no-repeat;
      opacity: 0;
      transition: opacity 1s ease-in-out;
    }

    .background-video {
      width: 100vw;
      height: 100%;
      object-fit: cover;
      position: absolute;
      top: 0;
      left: 0;
      z-index: 1;
    }

    .carousel-slide.active {
      opacity: 1;
    }

    .carousel-text {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      color: white;
      text-align: center;
      z-index: 2;
      text-shadow: 1px 1px 3px rgba(0,0,0,0.8);
      width: 100%;
      padding: 0 20px;
    }

    .carousel-text h1 { font-size: 3rem; margin-bottom: 1rem; }
    .carousel-text h2 { font-size: 2rem; }
    .carousel-text h4 { font-size: 1.2rem; }

    /* Page content area */
    .content {
      min-height: 100vh;
      padding: 0;
      background-color: #ffffff;
      color: #333;
      line-height: 1.8;
      font-size: 1.1rem;
      max-width: 1200px;
      margin: 0;
    }

    .content h2 { margin-bottom: 20px; }
    .content p { margin-bottom: 15px; }

    /* Responsive iframe container */
    .iframe-container {
      display: flex;
      width: 100vw;
      height: 100vh;
      justify-content: center;
      overflow: hidden;
      box-sizing: border-box;
      margin-left: calc(-50vw + 50%);
      margin-right: calc(-50vw + 50%);
    }

    /* iframe element styling */
    iframe {
      width: 100vw;
      height: 100vh;
      display: block;
      border: none;
      object-fit: cover;
    }

    /* Fullscreen iframe mode */
    .iframe-container.fullscreen {
      position: fixed;
      top: 0;
      width: 100vw;
      height: 100vh;
      z-index: 10;
    }

    /* Inline video gif next to title text */
    .brochure-gif {
      width: 10vw;
      height: auto;
      vertical-align: middle;
      margin-left: 10px;
    }

    /* Page footer styling */
    .quarto-page-footer {
      background-color: #FEF8F2;
      padding: 20px;
      font-size: 0.9rem;
      position: relative;
      bottom: 0;
      width: 100%;
    }

    .quarto-page-footer a {
      text-decoration: none;
    }

    .quarto-page-footer a:hover {
      text-decoration: underline;
    } 
    
    .nav-link {
      text-decoration: none;
      color: #5c3a21;
      padding: 8px 14px;
      border-radius: 6px;
      transition: all 0.3s ease;
      position: relative;  
    }

    .nav-link.active {
      background-color: #6F4F37 !important;
      color: white !important;
      font-weight: bold;
      box-shadow: 0 2px 8px rgba(0,0,0,0.2);
    }

    .nav-link.active::after {
      content: "";
      position: absolute;
      bottom: -5px;
      left: 50%;
      transform: translateX(-50%);
      width: 60%;
      height: 3px;
      background: white;
      border-radius: 3px;
    }

    .nav-link:hover:not(.active) {
      background-color: #f2e4d5;
      color: brown;
    }
      [id] {
  scroll-margin-top: 120px;
      }

      
      #backToTopBtn {
      display: none;
      position: fixed;
      bottom: 30px;
      left: 30px;
      z-index: 99;
      border: none;
      outline: none;
      background-color: #6F4F37;
      color: white;
      cursor: pointer;
      padding: 12px 16px;
      width: 50px;
      height: 50px;
      border-radius: 50%;
      font-size: 20px;
      box-shadow: 0 4px 6px rgba(0, 0, 0, 0.2);
      transition: opacity 0.3s ease;
    }
    #backToTopBtn:hover {
      background-color: #563d2d;
    }



     
  </style>
</head>

<body>
    <nav style="
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  background-color: #FEF8F2;
  padding: 12px 24px;
  display: flex;
  justify-content: center;
  gap: 1.5rem;
  z-index: 1000;
  box-shadow: 0 2px 6px rgba(0, 0, 0, 0.1);
  font-family: 'Segoe UI', sans-serif;
  font-weight: 500;
  font-size: 16px;
">

  <a href="#process" class="nav-link">Processing</a>
  <a href="#bean" class="nav-link">Category</a>
  <a href="#map" class="nav-link">Geography</a>
  <a href="#market" class="nav-link">Market</a>
  <a href="#bubble" class="nav-link">Bubble</a>
  <a href="#sentiment" class="nav-link">Sentiment</a>
  <a href="#conclusion" class="nav-link">Conclusion</a>

</nav>



 <script src="https://cdn.jsdelivr.net/npm/d3@7.0.0/dist/d3.min.js"></script>

    <h1 class="vibrant-title">Coffee Bean Brochure
        <video autoplay muted loop class="brochure-gif">
            <source src="../img/walking.mov" type="video/mp4">
            Your browser does not support the video tag.
        </video>
    </h1>
    <p style="text-align: center">Group9: Fangzhou Wang, Siru Wu, Yuxi Shen, Xun Lei</p>


    <div class="carousel-wrapper" id="process">
    
        <div class="carousel">
            <div class="carousel-slide active" style="background-image: url('https://intelligence.coffee/wp-content/uploads/2023/11/hand-picking-coffee.jpg');"> 
                <div class="carousel-text">
                    <h2>Processing Step 1：Picking</h2>
                    <h4><strong>Coffee beans are not beans, but seeds extracted from the coffee fruit. <br>After being picked, coffee seeds need to go through a series of processes to become the coffee we drink.</strong></h4>
                </div>
            </div>
            <div class="carousel-slide" style="background-image: url('https://perfectdailygrind.com/wp-content/uploads/2019/11/WhatsApp-Image-2019-03-20-at-20.53.05-4-1024x614.jpeg');"> 
                <div class="carousel-text"> 
                    <h2>Processing Step 2：Fermentation</h2>
                    <h4><strong>After the flesh is removed, the beans undergo a fermentation process. <br>Fermentation helps to remove pulp residue and improve flavor.</strong></h4>
                </div>
            </div>
    
            <div class="carousel-slide">
                <video autoplay muted loop style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; object-fit: cover;">
                    <source src="img/baking.mp4" type="video/mp4">
                    Your browser does not support the video tag.
                </video>
    
                <div class="carousel-text"> 
                    <h2>Processing Step 3：Baking</h2>
                    <h4><strong>During the roasting process, the water is evaporated and the flavor of the beans is further enhanced. <br>The roasting time and temperature of each coffee bean is different, which determines its taste.</strong></h4>
                    <p style="font-size: 0.8em; color: #dbd9d9; margin-top: 10px;">Video reference: <a href="https://www.pinterest.com/pin/50806302041911216/" target="_blank" rel="noopener noreferrer">Pinterest</a></p>
                </div>
            </div>
    
    
            <div class="carousel-slide">
                <video autoplay muted loop class="background-video">
                    <source src="img/grinding.mp4" type="video/mp4">
                    Your browser does not support the video tag.
                </video>
                <div class="carousel-text">
                    <h2>Processing Step 4：Grinding</h2>
                    <h4><strong>After roasting, the beans need to be ground into powder, which is used to brew coffee or make food products such as coffee cakes.</strong></h4>
                    <p style="font-size: 0.8em; color: #dbd9d9; margin-top: 10px;">Video reference: <a href="https://www.pinterest.com/pin/732960908142135451/" target="_blank" rel="noopener noreferrer">Pinterest</a></p>
                </div>
            </div>
        
        </div>
    </div>


<!-- iframe container -->
    <div class="iframe-container" id="bean">
        <iframe src="visualization/main.html" frameborder="0" id="scrollama-iframe"></iframe>
    </div>

<!-- Bottom website content -->

<div class="content">
    
   
        <h3 id="map">🌍 Where do Arabica and Robusta grow?</h3>
    
        <p>Here we explore where the world’s best Arabica and Robusta coffee beans are grown. The rankings are based on the average cup scores that countries have earned across different harvest years.</p>  
    
        <ul>
            <li>Begin by selecting a top country like Ethiopia from the bar chart. </li>
            <li>Follow its cup score trends in the scatter plot to see how quality is maintained over time. </li>
            <li>Then, hover over the map to uncover high-altitude regions, where cooler climates and rich soils create exceptional beans. </li>
        </ul>
        
        <p>By comparing different countries, you can discover how geography, climate, and farming traditions influence the flavors we love.
        </p>
    
        <div style="
        background-color: #dbc1ac;
        padding: 20px; 
        margin: 30px auto; 
        width: 30vw; 
        border-radius: 12px; 
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        text-align: center;
        ">
        <h4><strong>🌟 What is the Cup Score?</strong></h4>
        <p style="font-size: 15px; line-height: 1.6;">
            The Cup Score is how coffee earns its reputation.  
            Rated out of 100, it measures aroma, flavor, acidity, and body.  
            A score above 80 means the coffee is “specialty grade” — rare, rich, and crafted to perfection.
        </p>
        </div>
    
        <label for="coffeeFilter"><strong>Select Coffee Type:</strong></label> <select id="coffeeFilter" onchange="switchIframe()"> <option value="arabica">Arabica</option> <option value="robusta">Robusta</option> </select>
    
    
    
        <div class="iframe-container">
            <iframe id="arabicaIframe" src="visualization/arabica_geo.html" 
                    style="width: 60vw; height: 100vh; border: none;"></iframe>
            <iframe id="robustaIframe" src="visualization/robusta_geo.html" 
                    style="width: 60vw; height: 100vh; border: none; display: none;"></iframe>
        </div>
        
        <script>
        function switchIframe() {
        var coffeeType = document.getElementById("coffeeFilter").value;
        var arabicaIframe = document.getElementById("arabicaIframe");
        var robustaIframe = document.getElementById("robustaIframe");
        
        if (coffeeType === "arabica") {
            arabicaIframe.style.display = "block";
            robustaIframe.style.display = "none";
        } else if (coffeeType === "robusta") {
            arabicaIframe.style.display = "none";
            robustaIframe.style.display = "block";
        }
        }
        </script> 
    
        <p>   
        Arabica beans show higher and more consistent average cup scores across countries and time, with top performers like United State(Hawaii) and Ethiopia. Robusta beans, while more geographically concentrated, generally have lower cup scores and greater variation across regions. The Coffee Belt highlights global growing zones for both types. </p>
 
    
        <h2 id="market">💰 Does a high cupping score mean high exportation prices?</h2>
    
        <p>The chart below illustrates the global dynamics and price distribution of coffee bean exports. We selected the three countries with the highest average cupping scores:</p>
    
        <ul>
            <li>🥇 Thailand (84.51)</li>
            <li>🥈 United States (84.33)</li>
            <li>🥉 Lao PDR (83.77)</li>
        </ul>
    
        <p>
        For each country, we focus on its top 10 export destinations, which typically account for over 70% of its total coffee exports.
        Click on a country name—Thailand, the United States, or Lao PDR—to reveal its top 10 export destinations.
        When hovered over, the bar charts below will show each destination’s trade value and unit price (USD/kg).
        </p>
    
        <p>
        Coffees from the United States and Thailand are consistently sold at higher average unit prices—
        <strong>around 6.5 and 6.0 USD/kg</strong>, respectively—compared to <strong>Lao PDR’s 3.1 USD/kg</strong>, aligning with their higher cupping scores.
        </p>
    
        <p><strong>Notably:</strong></p>
        <ol>
        <li>
            The U.S. exports to <strong>Asian markets</strong> like Japan, Korea, and China at especially high prices, often above 7 USD/kg, 
            while sales to Western countries like Canada and Germany are lower.
        </li>
        <li>
            Thailand’s export prices fall in a moderate range of 5.3–6.9 USD/kg.
        </li>
        <li>
            Lao PDR’s prices remain very stable across destinations, mostly within 2.9–3.3 USD/kg.
        </li>
        </ol>
       
<!--         <div style="display: flex; flex-direction: column; align-items: center;">
          <iframe src="visualization/tree.html" width="100%" height="1000" style="border: none;"></iframe>
        </div> -->
        <div id="market" style="width: 100vw; height: 1100px; margin-left: calc(-50vw + 50% - 50px);">
          <iframe
            src="visualization/tree.html"
            frameborder="0"
            id="scrollama-iframe"
            style="width: 100vw; height: 100%; border: none; display: block;">
          </iframe>
        </div>



    
 
        <div class="iframe-container" id="bubble">
            <iframe src="visualization/coffee_bubbles.html" frameborder="0" id="scrollama-iframe"></iframe>
        </div>
    
        <div style="
          display: flex;
          justify-content: center;
          align-items: center;
/*           width: 100vw; */
          height: 100vh;
          box-sizing: border-box;
          margin: 0;
          overflow: hidden;
        " id="sentiment">
          <iframe 
            src="visualization/sentiment_block.html" 
            frameborder="0" 
            style="
/*               width: 80vw; */
              height: 100vh;
              border: none;
/*               transform: translateX(-12vw); */
            ">
          </iframe>
        </div>


  
    
</div>


<div class='vibrant-title-down' id="conclusion">
<div id="conclusion">
  <p>
    Through this journey, from the farm to the global market and into everyday conversations, we hope you now see that coffee is not just a drink, but a story shaped by nature, craftsmanship, and the passions of people all around the world.</p>
</div>



<!-- Carousel functionality script -->
    <script>
        let currentSlide = 0;
        const slides = document.querySelectorAll('.carousel-slide');
        const totalSlides = slides.length;
    
        function showSlide(index) {
            slides.forEach((slide, i) => {
                slide.classList.toggle('active', i === index);
            });
        }
    
        // auto play
        setInterval(() => {
            currentSlide = (currentSlide + 1) % totalSlides;
            showSlide(currentSlide);
        }, 3000); 
    </script>
    
    <script>
        document.addEventListener("DOMContentLoaded", () => {
          const navLinks = document.querySelectorAll(".nav-link");
          const navHeight = document.querySelector("nav").offsetHeight;
        
          const sections = Array.from(navLinks).map(link => {
            const target = document.querySelector(link.getAttribute("href"));
            return { link, target };
          }).filter(item => item.target !== null);
        
          function getElementPosition(el) {
            const rect = el.getBoundingClientRect();
            return {
              top: rect.top + window.scrollY,
              bottom: rect.bottom + window.scrollY,
              height: rect.height
            };
          }
        
          function setActiveLink(activeLink) {
            navLinks.forEach(l => l.classList.remove("active"));
            activeLink.classList.add("active");
          }
        
          function isAtBottom() {
            return window.innerHeight + window.scrollY >= document.body.offsetHeight - 100;
          }
        
          function updateActiveNav() {
            const scrollPos = window.scrollY + navHeight + 20;
            let activeFound = false;
        
            sections.forEach(({ link, target }) => {
              const pos = getElementPosition(target);
              if (scrollPos >= pos.top && scrollPos < pos.bottom) {
                setActiveLink(link);
                activeFound = true;
              }
            });
        
            if (!activeFound && isAtBottom()) {
              setActiveLink(sections[sections.length - 1].link);
            }
          }
        
          navLinks.forEach(link => {
            link.addEventListener("click", (e) => {
              e.preventDefault();
              const target = document.querySelector(link.getAttribute("href"));
              if (target) {
                setActiveLink(link);
                setTimeout(() => {
                  target.scrollIntoView({ behavior: 'smooth', block: 'start' });
                }, 50);
              }
            });
          });
        
          let ticking = false;
          window.addEventListener("scroll", () => {
            if (!ticking) {
              window.requestAnimationFrame(() => {
                updateActiveNav();
                ticking = false;
              });
              ticking = true;
            }
          });
        
          if (window.location.hash) {
            const initialLink = document.querySelector(`.nav-link[href="${window.location.hash}"]`);
            const target = document.querySelector(window.location.hash);
            if (initialLink && target) {
              setTimeout(() => {
                setActiveLink(initialLink);
                target.scrollIntoView({ behavior: 'smooth', block: 'start' });
              }, 100);
            }
          }
        
          updateActiveNav();
        });
    </script>
    <!-- Back to Top Button -->
  <button onclick="scrollToTop()" id="backToTopBtn" title="Back to top">↑</button>

  <script>
    function scrollToTop() {
      window.scrollTo({ top: 0, behavior: 'smooth' });
    }

    window.addEventListener("scroll", () => {
      const btn = document.getElementById("backToTopBtn");
      if (window.scrollY > 100) {
        btn.style.display = "block";
      } else {
        btn.style.display = "none";
      }
    });
  </script>



        
   
    
</body>


</html>
```